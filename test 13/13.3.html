<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>规范化Event对象</title>
</head>
<body>
<script>
function fixEvent(event){
    // 预定义常用函数
    function returnTrue(){
        return true;
    };
    function returnFalse(){
        return false;
    };

    // 测试是否需要修复
    if(!event || !event.stopPropagation){
        var old=event || window.event,
            event={};

        // 克隆现有属性
        for(var prop in old){
            event[prop]=old[prop];
        };

        // 修复属性
        if(!event.target){
            event.target=event.srcElement || document;
        };

        event.relatedTarget=event.fromElement === event.target ? event.toElement : event.fromElement;

        event.preventDefault=function(){
            event.returnValue=false;
            event.isDefaultPrevented=returnTrue;
        };
        event.isDefaultPrevented=returnFalse;

        event.stopPropagation=function(){
            event.canceBubble=true;
            event.isPropagationStopped=returnTrue;
        };
        event.isPropagationStopped=returnFalse;

        event.stopImmediatePropagation=function(){
            this.isImmediatePropagationStopped=returnTrue;
            this.stopPropagation();
        };
        event.isImmediatePropagationStopped=returnFalse;

        if(event.clientX!=null){
            var doc=document.documentElement,
                body=document.body;

            event.pageX=event.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
            event.pageY=event.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);
        };

        event.which=event.charCode || event.keyCode;

        if (event.button != null) {
         event.button = ( event.button & 1 ? 0 : ( event.button & 4 ? 1 : ( event.button & 2 ? 2 : 0 ) ) );
        };

        return event;
    }
} 

</script>
</body>
</html>